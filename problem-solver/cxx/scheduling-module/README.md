# Scheduling Module (Модуль составления расписания)

Модуль для автоматического составления расписания работы сотрудников ресторана с использованием алгоритма максимального паросочетания в двудольном графе.

## Возможности

1. **Импорт штата сотрудников** из CSV-файла
2. **Настройка требований к составу смены** (количество сотрудников каждой профессии)
3. **Ограничения по сменам** для каждого сотрудника (разрешённые/запрещённые)
4. **Автоматическое построение оптимального расписания** с балансировкой нагрузки
5. **Расчёт загруженности** каждого сотрудника

---

## 1. Импорт сотрудников (ImportStaffAgent)

### Формат CSV-файла

```csv
profession,name,allowed_shifts,forbidden_shifts
повар,Антонов,,N
администратор,Львов,D,
официант,Дмитриев,,
```

### Колонки

| Колонка | Описание | Обязательная |
|---------|----------|--------------|
| `profession` | Профессия сотрудника | Да |
| `name` | Имя сотрудника | Да |
| `allowed_shifts` | Разрешённые смены (через `;`) | Нет |
| `forbidden_shifts` | Запрещённые смены (через `;`) | Нет |

### Значения профессий

| Профессия |
|-----------|
| повар |
| официант |
| уборщик |
| администратор |

### Коды смен

| Код | Смена |
|-----|-------|
| `M` | Утренняя (Morning) |
| `D` | Дневная (Day) |
| `N` | Ночная (Night) |

### Примеры CSV

**Формат 1: Только разрешённые смены**
```csv
profession,name,allowed_shifts
администратор,Львов,D
официант,Дмитриев,M;D;N
```

**Формат 2: Только запрещённые смены**
```csv
profession,name,forbidden_shifts
повар,Антонов,N
повар,Белов,N
```

**Формат 3: Оба типа ограничений**
```csv
profession,name,allowed_shifts,forbidden_shifts
повар,Антонов,,N
администратор,Львов,D,
официант,Дмитриев,,
```

### Вызов агента

```scs
action_import_staff
<- action_import_staff_from_csv;
=> nrel_file_content: [содержимое CSV файла];;
```

---

## 2. Требования к составу смены

Требования задаются через базу знаний:

```scs
// Количество сотрудников каждой профессии на смену
concept_cook => nrel_required_count: [1];;
concept_waiter => nrel_required_count: [2];;
concept_cleaner => nrel_required_count: [1];;
concept_admin => nrel_required_count: [1];;

// Максимум смен в неделю для одного сотрудника
shift_requirements
<- concept_shift_requirements;
=> nrel_max_shifts_per_week: [5];;
```

### Или через аргументы действия

Требования передаются как первый аргумент (`rrel_1`) действия `action_build_weekly_schedule`.

---

## 3. Построение расписания (ScheduleBuilderAgent)

### Алгоритм

1. **Построение двудольного графа**:
   - Левая доля: сотрудники
   - Правая доля: слоты смен (день × тип смены × позиция)
   - Рёбра: сотрудник может работать в слоте

2. **Максимальное паросочетание** (алгоритм Куна):
   - Учитывает ограничения по сменам
   - Соблюдает лимит смен в неделю
   - Один сотрудник — одна смена в день
   - Балансирует нагрузку

3. **Результат**:
   - Двудольный граф в SC-memory
   - Назначения на смены
   - Загруженность сотрудников

### Вызов агента

```scs
action_build_schedule
<- action_build_weekly_schedule;
-> rrel_1: shift_requirements;;
```

---

## 4. Пример использования (Вариант 7)

### Входные данные

**Штат (12 сотрудников):**
- 4 повара (не могут работать в ночную смену)
- 4 официанта (без ограничений)
- 2 уборщика (без ограничений)
- 2 администратора (только дневная смена)

**Требования к смене:**
- 1 повар
- 2 официанта
- 1 уборщик
- 1 администратор

**Ограничения:**
- Максимум 5 смен в неделю на сотрудника

### CSV-файл

```csv
profession,name,allowed_shifts,forbidden_shifts
повар,Антонов,,N
повар,Белов,,N
повар,Васильев,,N
повар,Гришин,,N
официант,Дмитриев,,
официант,Егоров,,
официант,Жуков,,
официант,Зайцев,,
уборщик,Иванов,,
уборщик,Козлов,,
администратор,Львов,D,
администратор,Михайлов,D,
```

### Результат

Агент создаёт:
- `concept_bipartite_graph` — двудольный граф
- `concept_shift_assignment` — назначения на смены
- `nrel_workload` — загруженность сотрудников

---

## 5. Структура SC-memory

### Keynodes

```
action_import_staff_from_csv    — класс действия импорта
action_build_weekly_schedule    — класс действия построения расписания

concept_employee                — класс сотрудников
concept_cook                    — повара
concept_waiter                  — официанты
concept_cleaner                 — уборщики
concept_admin                   — администраторы

concept_morning_shift           — утренняя смена
concept_day_shift               — дневная смена
concept_night_shift             — ночная смена

nrel_allowed_shift              — разрешённые смены
nrel_can_not_work               — запрещённые смены
nrel_required_count             — требуемое количество
nrel_max_shifts_per_week        — максимум смен в неделю
nrel_workload                   — загруженность

concept_bipartite_graph         — двудольный граф
concept_shift_slot              — слот смены
concept_shift_assignment        — назначение на смену
```

---

## Тестирование

```bash
# Сборка
cmake --build --preset conan-release

# Запуск тестов
./build/Release/bin/scheduling-module-tests
```
